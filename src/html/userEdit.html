<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>用户信息修改</title>
		<link rel="stylesheet" href="../layui-v2.4.5/layui/css/layui.css">

		<style type="text/css">
			.navtitle {
				color: white;
				margin: 0 15px;
			}
			
			.demo-carousel {
				height: 200px;
				line-height: 200px;
				text-align: center;
			}
		</style>

		<script type="text/javascript" src="../layui-v2.4.5/layui/layui.js"></script>
	</head>

	<body class="layui-layout-body">
		<div class="layui-layout layui-layout-admin">
			<!--头部-->
			<div class="layui-header">
				<div class="layui-logo">电商后台管理系统</div>
				<!-- 头部区域（可配合layui已有的水平导航） -->
				<ul class="layui-nav layui-layout-left">
					<!--<li class="layui-nav-item">
						<a href="">控制台</a>
					</li>-->
					<li class="layui-nav-item">
						<a href="goodslist.html">商品管理</a>
					</li>
					<li class="layui-nav-item">
						<a href="userlist.html">用户</a>
					</li>
					<!--<li class="layui-nav-item">
						<a href="javascript:;">其它系统</a>
						<dl class="layui-nav-child">
							<dd>
								<a href="">邮件管理</a>
							</dd>
							<dd>
								<a href="">消息管理</a>
							</dd>
							<dd>
								<a href="">授权管理</a>
							</dd>
						</dl>
					</li>-->
				</ul>
				<ul class="layui-nav layui-layout-right">
					<li class="layui-nav-item">
						<a href="javascript:;">
							<img src="http://t.cn/RCzsdCq" class="layui-nav-img"> 贤心
						</a>
						<dl class="layui-nav-child">
							<dd>
								<a href="">基本资料</a>
							</dd>
						</dl>
					</li>
					<li class="layui-nav-item">
						<a href="">退了</a>
					</li>
				</ul>
			</div>

			<!--左侧栏-->
			<div class="layui-side layui-bg-black">
				<div class="layui-side-scroll">
					<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
					<ul class="layui-nav layui-nav-tree" lay-filter="test">
						<li class="layui-nav-item layui-nav-itemed">
							<a class="" href="javascript:;">所有商品</a>
							<dl class="layui-nav-child">
								<dd>
									<a href="goodslist.html">商品列表</a>
								</dd>
								
							</dl>
						</li>
						<li class="layui-nav-item">
							<a href="javascript:;">用户管理</a>
							<dl class="layui-nav-child">
								<dd>
									<a href="userAdd.html">用户添加</a>
								</dd>
								<dd>
									<a href="userEdit.html">修改用户信息</a>
								</dd>
							</dl>
						</li>
						<li class="layui-nav-item">
							<a href="javascript:;">订单管理</a>
							<dl class="layui-nav-child">
								<dd>
									<a href="orderlist.html">订单列表</a>
								</dd>
								<dd>
									<a href="orderEdit.html">订单状态修改</a>
								</dd>
							</dl>
						</li>
					</ul>
				</div>
			</div>

			<div class="layui-body">
				<!-- 内容主体区域 -->
				<script src="../js/editTitle.js" type="text/javascript" charset="utf-8"></script>
				<div style="padding: 15px;">
					<form class="layui-form" action="" lay-filter="example">
						<div class="layui-form-item">
							<label class="layui-form-label">用户名</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入用户名" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">昵称</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="text" name="logins" lay-verify="required" placeholder="请输入昵称" autocomplete="off" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">性别</label>
								<div class="layui-input-inline" style="width: 100px;">
									<select name="sex" lay-filter="aihao">
										<option value=""></option>
										<option value="男">男</option>
										<option value="女">女</option>
										<option value="保密">保密</option>
									</select>
								</div>
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">手机号</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="text" name="phonenumber" lay-verify="phone" placeholder="请输入" autocomplete="off" class="layui-input">
							</div>
						</div>

						<div class="layui-form-item">
							<label class="layui-form-label">生日</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="text" name="birth" lay-verify="required" id="date1" autocomplete="off" placeholder="请输入生日" class="layui-input">
							</div>
						</div>

						<div class="layui-form-item">
							<label class="layui-form-label">邮箱地址</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="text" name="email" lay-verify="email" autocomplete="off" placeholder="请输入邮箱" class="layui-input">
							</div>
						</div>
						<div class="layui-form-item">
							<label class="layui-form-label">密码</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="password" name="psw"  lay-verify="pass" autocomplete="off" placeholder="请输入密码" class="layui-input">
							</div>
						</div>

						<div class="layui-form-item">
							<label class="layui-form-label">确认密码</label>
							<div class="layui-input-block" style="width: 500px;">
								<input type="password" name="comfirepsw" lay-verify="pass" autocomplete="off" placeholder="请再输入密码" class="layui-input">
							</div>
						</div>

						<div class="layui-form-item layui-form-text">
							<label class="layui-form-label">备注</label>
							<div class="layui-input-block">
								<textarea placeholder="请输入内容" name="introduce" class="layui-textarea"></textarea>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<button class="layui-btn" lay-submit="" lay-filter="demo1">确认修改</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							</div>
						</div>
					</form>
				</div>
			</div>

			<div class="layui-footer">
				<!-- 底部固定区域 -->
			</div>
		</div>
		<!--查询相应_id的信息并渲染到页面表单内-->
		<script>
			//JavaScript代码区域
			layui.use('element', function() {
				var element = layui.element;
			});

			layui.use(['form', 'layedit', 'laydate'], function() {
				var form = layui.form,
					layer = layui.layer,
					layedit = layui.layedit,
					laydate = layui.laydate;

				//日期
				laydate.render({
					elem: '#date'
				});
				laydate.render({
					elem: '#date1'
				});

				//创建一个编辑器
				var editIndex = layedit.build('LAY_demo_editor');

				//自定义验证规则
				form.verify({
					title: function(value) {
						if(value.length < 4) {
							return '用户名至少得4个字符啊';
						}
					},
					pass: [
						/^[\S]{6,12}$/, '密码必须6到12位，且不能出现空格'
					],
					phone: [
						/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])[\d]{8}$/, '手机号不符合要求'
					],
					email: [
						/^[\w]+([-+.][\w]+)*@[\w]+([-.][\w]+)*[\.][\w]+([-.][\w]+)*$/, '邮箱号码不符合要求'
					],
					content: function(value) {
						layedit.sync(editIndex);
					}
				});
				
				
				let _id = location.search.slice(5);
				//监听修改
				form.on('submit(demo1)', function(data) {
					if(data.field.psw ==data.field.comfirepsw){
						let xhr =new XMLHttpRequest();
						xhr.onload =()=>{
							if(!JSON.parse(xhr.responseText).code){
								location.href = 'userlist.html';
							}
						}
						xhr.open('POST','/userUpdata',true);
						xhr.setRequestHeader('Content-Type', 'application/json');
						data.field._id = _id;
						xhr.send(JSON.stringify(data.field));
						return false;
					}else{
						layer.alert('两次输入的密码不一样');
						return false;
					}
				});
				
				//初始化表单内容到页面用来修改
				let formdefault={};
				let xhr =new XMLHttpRequest();
				xhr.onload =()=>{
					formdefault = JSON.parse(xhr.responseText).data[0];
					//表单初始赋值
					form.val('example', formdefault);
				}
				xhr.open('get','/findBy_id?colname=user&_id='+_id,true);
				xhr.send();
			});
		</script>
	</body>

</html>
